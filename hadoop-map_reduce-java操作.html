<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><meta name="exporter-version" content="Evernote Mac 9.4.1 (460875)"/><meta name="keywords" content="hadoop, java, linux"/><meta name="author" content="November"/><meta name="created" content="2020-08-02 01:50:02 +0000"/><meta name="source" content="desktop.mac"/><meta name="updated" content="2020-08-25 07:52:26 +0000"/><title>hadoop-map/reduce-java操作</title></head><body><div><div><br/></div><table style="border-collapse: collapse; min-width: 100%;"><colgroup><col style="width: 441px;"/><col style="width: 439px;"/></colgroup><tbody><tr><td colspan="2" style="background-color: rgb(0, 168, 45); border: 1px solid rgb(0, 134, 36); width: 880px; padding: 8px;"><div style="text-align: center; "><span style="font-size: 24px; --inversion-type-color:  simple;"><span style="font-size: 24px; --inversion-type-color:  simple; color: rgb(204, 204, 204); font-weight: bold;">hadoop-map/reduce-java操作</span></span></div></td></tr><tr><td style="background-color: rgb(234, 234, 234); border: 1px solid rgb(187, 187, 187); width: 441px; padding: 8px;"><div>线索Cues</div></td><td style="background-color: rgb(234, 234, 234); border: 1px solid rgb(187, 187, 187); width: 439px; padding: 8px;"><div>笔记Notes</div></td></tr><tr><td style="border: 1px solid rgb(204, 204, 204); width: 441px; padding: 8px;"><div>由于操作过多，具体看ideaProjects，这里主要是讲可以进行哪些操作。大致分为 <span style="font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: pre; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(243, 244, 245); color: rgb(51, 51, 51); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">STARTING,MAP,SHUFFLE,SORT,REDUCE,CLEANUP 等阶段</span></div><ol><li><div>读取环境变量，job，jar</div></li><li><div>进入map task首先要读取文件 FileInputFormat，获取recordReader</div></li><li><div>自定义一个RecorReder，读取数据</div></li><li><div>通过k,v read()读取切片进入paper</div></li><li><div>通过序列化，赋值存储k,v（必须有空参构造）</div></li><li><div>读取自定义key，用于reduce</div></li><li><div>获取recordWriter，用于reduce</div></li><li><div>自定义一个recordWriter</div></li><li><div>当通过反序列化读取完key和输出地址后，进入reduce，最后根据recordWriter输出最终结果</div></li></ol></td><td style="border: 1px solid rgb(204, 204, 204); width: 439px; padding: 8px;"><ol><li><div>根据需要配置job</div></li><li><div>继承FileInputFormat&lt;输出类型&gt;两个方法：</div></li><ol><li><div>isSplitable :可以设置是否进行切片</div></li><li><div>createRecordReader：从切片中读取每一行数据，不切片则读取整个文件</div></li></ol><li><div>继承RecorReder 六个方法：</div></li><ol><li><div>initialize：用于初始化调用</div></li><li><div>nextKeyValue：对key和value进行赋值</div></li><li><div>getCurrentKey：RecorReder会通过此方法获取key</div></li><li><div>getCurrentValue：RecorReder会通过此方法获取value</div></li><li><div>getProgress：得到当前进度</div></li><li><div>close：用于清理RecorReder，类似io等</div></li></ol><li><div>继承Mapper&lt;数据输入k,v,map输出k,v&gt; 四个方法：</div></li><ol><li><div>setup：map初始化</div></li><li><div>map：逻辑层，用于写业务逻辑</div></li><li><div>cleanup：用于清理mapper</div></li><li><div>run：执行方法</div></li></ol><li><div>继承WritableComparable&lt;类&gt; 三个方法：</div></li><ol><li><div>compareTo：排序</div></li><li><div>write：序列化</div></li><li><div>readFields：反序列化</div></li></ol><li><div>继承WritableComparator 两个方法：</div></li><ol><li><div>空参构造：需要注册所需要的类</div></li><li><div>compare：设置同类key的规则逻辑</div></li></ol><li><div>继承FileOutputFormat&lt;reduce输出k,v&gt; 一个方法：</div></li><ol><li><div>getRecorWriter：获取一个recorWriter</div></li></ol><li><div>继承RecorReader&lt;reduce输出k,v&gt; 三个方法：</div></li><ol><li><div>构造方法：用于FileOutputFormat进行调用</div></li><li><div>write：向最终输出地址输出内容</div></li><li><div>close：清理此类</div></li></ol><li><div>继承Reducer&lt;map输出k,v,reduce输出k,v&gt; 四个方法：</div></li><ol><li><div>setup：reduce初始化</div></li><li><div>reduce：逻辑层</div></li><li><div>cleaup：清理reduce</div></li><li><div>run：执行方法</div></li></ol></ol></td></tr><tr><td colspan="2" style="background-color: rgb(234, 234, 234); border: 1px solid rgb(187, 187, 187); width: 880px; padding: 8px;"><div>报错解决：</div></td></tr><tr><td colspan="2" style="border: 1px solid rgb(204, 204, 204); width: 880px; padding: 8px;"><div>1.在执行 hadoop jar xxx.jar的时候出现：</div><div><img src="hadoop-map_reduce-java%E6%93%8D%E4%BD%9C.resources/D9E70D0B-353F-4453-B26A-C5668ECCF9B5.png" height="1750" width="3506"/><br/></div><div>解决方法：</div><div><span style="--inversion-type-color: simple; color: rgb(0, 253, 255);">vim /etc/sysconfig/network</span></div><div><span style="--inversion-type-color:  simple; color: rgb(0, 0, 0);">添加：</span></div><div><span style="--inversion-type-color: simple; color: rgb(0, 253, 255);">NETWORKING=yes</span></div><div><span style="--inversion-type-color: simple; color: rgb(0, 253, 255);">NETWORKING_IPV6=yes</span></div><div><span style="--inversion-type-color: simple; color: rgb(0, 253, 255);">HOSTNAME=主机名</span></div><div><span style="caret-color: rgb(0, 253, 255);"><span style="--inversion-type-color:  simple; color: rgb(0, 0, 0);">重启服务：</span></span></div><div><span style="font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="background-color: rgb(255, 255, 255); font-size: 14px; --inversion-type-color: simple; color: rgb(0, 253, 255); font-family: &quot;Microsoft YaHei&quot;, &quot;SF Pro Display&quot;, Roboto, Noto, Arial, &quot;PingFang SC&quot;, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">/etc/rc.d/init.d/network restart </span></span></div></td></tr><tr><td style="border: 1px solid rgb(204, 204, 204); width: 880px; padding: 8px;" colspan="2"><div>2.在执行 hadoop jar xxx.jar的时候出现：</div><div><img src="hadoop-map_reduce-java%E6%93%8D%E4%BD%9C.resources/C6704A56-A399-4319-9A0C-FA1EA8D6ABBB.png" height="1984" width="3520"/><br/></div><div>解决方法：</div><div>根据提示在配置文件中添加对应的配置</div><div>这里是 mapper-site.xml配置文件中，需要添加yarn.app.mapreduce.am.env  mapreduce.map.env  mapreduce.reduce.env</div></td></tr><tr><td style="border: 1px solid rgb(204, 204, 204); width: 880px; padding: 8px;" colspan="2"><div>3.在执行 hadoop jar xxx.jar的时候出现：<img src="hadoop-map_reduce-java%E6%93%8D%E4%BD%9C.resources/EB38E61A-DE0F-41E1-BF94-0B959F8040C9.png" height="812" width="3274"/><br/></div><div>这个是输出目录已经存在</div><div>解决方法：</div><div>删除存在的输出目录，或者另外给予输出目录</div></td></tr><tr><td style="border: 1px solid rgb(204, 204, 204); width: 880px; padding: 8px;" colspan="2"><div>4.在执行 hadoop jar xxx.jar的时候出现：<img src="hadoop-map_reduce-java%E6%93%8D%E4%BD%9C.resources/36E59D02-9A5B-437F-A555-355895BF45ED.png" height="1264" width="3526"/><br/></div><div>主机和从机的时区不一致</div><div>解决方法：</div><div><span style="font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: pre; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(246, 248, 250); --inversion-type-color:  simple; color: rgb(79, 79, 79); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-variant-caps: normal; font-variant-ligatures: common-ligatures;">yum -y</span><span style="--inversion-type-color: simple; color: rgb(0, 253, 255);" /><span style="box-sizing: border-box; outline: 0px; font-size: 14px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: pre; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; --inversion-type-color:  simple; color: rgb(0, 0, 136); font-family: &quot;Microsoft YaHei&quot;, &quot;SF Pro Display&quot;, Roboto, Noto, Arial, &quot;PingFang SC&quot;, sans-serif; font-variant-caps: normal; font-variant-ligatures: common-ligatures;">install</span><span style="--inversion-type-color: simple; color: rgb(0, 253, 255);" /><span style="font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: pre; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(246, 248, 250); --inversion-type-color:  simple; color: rgb(79, 79, 79); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-variant-caps: normal; font-variant-ligatures: common-ligatures;">ntp ntpdate</span></div><div><span style="--inversion-type-color: simple; color: rgb(0, 253, 255);">ntpdate </span><a href="http://cn.pool.ntp.org/" style="--inversion-type-color:  simple;">cn.pool.ntp.org</a></div></td></tr><tr><td style="border: 1px solid rgb(204, 204, 204); width: 880px; padding: 8px;" colspan="2"><div><br/></div></td></tr></tbody></table><div><br/></div></div><div><br/></div></body></html>