<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><meta name="exporter-version" content="Evernote Mac 9.4.8 (461813)"/><meta name="keywords" content="bigdata, hive, linux"/><meta name="author" content="November"/><meta name="created" content="2020-09-13 04:31:29 +0000"/><meta name="source" content="desktop.mac"/><meta name="updated" content="2020-09-21 01:22:27 +0000"/><title>hive-表-常见操作</title></head><body><div><br/></div><div> </div><table style="border-collapse: collapse; min-width: 100%;"><colgroup><col style="width: 441px;"/><col style="width: 439px;"/></colgroup><tbody><tr><td colspan="2" style="vertical-align: middle; background-color: rgb(0, 168, 45); border: 1px solid rgb(0, 134, 36); width: 880px; padding: 8px;"><div style="text-align: center; "><span style="font-size: 24px; --inversion-type-color:  simple;"><span style="font-size: 24px; --inversion-type-color:  simple; color: rgb(255, 255, 255); font-weight: bold;">hive-表-常见操作</span></span></div></td></tr><tr><td style="background-color: rgb(234, 234, 234); border: 1px solid rgb(187, 187, 187); width: 441px; padding: 8px;"><div>线索Cues</div></td><td style="background-color: rgb(234, 234, 234); border: 1px solid rgb(187, 187, 187); width: 439px; padding: 8px;"><div>笔记Notes</div></td></tr><tr><td style="border: 1px solid rgb(204, 204, 204); width: 441px; padding: 8px;"><ol><li><div>查询所有表</div></li><li><div>查询表的信息</div></li><li><div>删除表</div></li><li><div>清空表（只能清空管理表）</div></li><li><div>查看表分区</div></li><li><div>创建分区</div></li><li><div>删除分区</div></li><li><div>修复分区</div></li><li><div>添加表</div></li><li><div>复制表结构（可以复制分区表）</div></li><li><div>通过查询结果建立新表（不可以复制分区表）</div></li><li><div>抽样查询（必须是分桶表） </div></li><li><div>修改表属性</div></li><li><div>操作表列</div></li><li><div>导入数据</div></li><li><div>导出数据</div></li><li><div>特殊比较运算符</div></li><li><div>排序</div></li><li><div>查看当前库所有函数</div></li><li><div>查看某函数的使用</div></li><li><div>查看查询语句的map/reduce的执行计划</div></li><li><div>表优化</div></li></ol><div><br/></div></td><td style="border: 1px solid rgb(204, 204, 204); width: 439px; padding: 8px;"><ol><li><div><span style="font-size: 14px;">Show tables;</span></div></li><li><div><span style="font-size: 14px;">Desc 表名;</span></div></li><ol><li><div><span style="font-size: 14px;">Desc extended 表名; （查询表的详细信息）</span></div></li><li><div><span style="font-size: 14px;">Desc formatted 表名;（格式化查看表的详细信息）</span></div></li></ol><li><div><span style="font-size: 14px;">Drop </span>table if exists<span style="font-size: 14px;"> 表名;</span></div></li><li><div>Truncate table 表名;</div></li><li><div><span style="font-size: 14px;">Show partitions 表名;</span></div></li><li><div><span style="font-size: 14px;">Alter table 表名 add partition(创表时分区字段名=分区字段值);</span></div></li><ol><li><div><span style="font-size: 14px;">同时创建多个分区：alter table 表名 add partition(创表时分区字段名=分区字段值) partition(创表时分区字段名=分区字段值) ;</span></div></li></ol><li><div><span style="font-size: 14px;">Alter table 表名 drop partition(创表时分区字段名=分区字段值)</span></div></li><ol><li><div><span style="font-size: 14px;">同时删除多个分区：Alter table 表名 drop partition(创表时分区字段名=分区字段值), partition(创表时分区字段名=分区字段值)</span></div></li></ol><li><div><span style="font-size: 14px;">Msck repair table 表名;</span><span style="font-size: 14px; --inversion-type-color:  simple; color: rgb(108, 0, 0);">（表结构一定要相同）</span></div></li><li><div><span style="font-size: 14px;">添加表：</span></div></li><ol><li><div><font style="font-size: 14px;"><span style="--inversion-type-color:  simple; font-size: 14px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;;">CREATE [</span><span style="font-size: 14px; color: rgb(255, 0, 0); font-family: &quot;Courier New&quot;;">EXTERNAL</span><span style="--inversion-type-color:  simple; font-size: 14px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;;">] TABLE [IF NOT EXISTS] table_name</span></font></div></li><li><div><font style="font-size: 14px;"><span style="--inversion-type-color:  simple; font-size: 14px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;;">[(col_name data_type [COMMENT col_comment], …)]</span><span style="--inversion-type-color:  simple; font-size: 14px; color: rgb(108, 0, 0); font-family: &quot;Courier New&quot;;">//字段信息</span></font></div></li><li><div><span style="font-size: 14px; font-family: &quot;Courier New&quot;;">[COMMENT table_comment]</span><span style="--inversion-type-color:  simple; font-size: 14px; color: rgb(108, 0, 0); font-family: &quot;Courier New&quot;;">//表注释信息</span></div></li><li><div><font style="font-size: 14px;"><span style="font-size: 14px; font-family: &quot;Courier New&quot;;">[</span><span style="--inversion-type-color:  simple; font-size: 14px; color: rgb(108, 0, 0); font-family: &quot;Courier New&quot;;">PARTITIONED BY</span><span style="font-size: 14px; font-family: &quot;Courier New&quot;;"> (col_name data_type [COMMENT col_comment], …)]</span><span style="--inversion-type-color:  simple; font-size: 14px; color: rgb(108, 0, 0); font-family: &quot;Courier New&quot;;">//设置分区</span></font></div></li><li><div><span style="font-size: 14px; font-family: &quot;Courier New&quot;;">[</span><span style="font-size: 14px; --inversion-type-color:  simple; color: rgb(108, 0, 0); font-family: &quot;Courier New&quot;;">CLUSTERED BY</span><span style="font-size: 14px; font-family: &quot;Courier New&quot;;"> (col_name, col_name, …)</span><span style="font-size: 14px; --inversion-type-color:  simple; color: rgb(108, 0, 0); font-family: &quot;Courier New&quot;;">//分桶</span></div></li><li><div><font style="font-size: 14px;"><span style="font-size: 14px; font-family: &quot;Courier New&quot;;">[</span><span style="font-size: 14px; --inversion-type-color:  simple; color: rgb(108, 0, 0); font-family: &quot;Courier New&quot;;">SORTED BY </span><span style="font-size: 14px; font-family: &quot;Courier New&quot;;">(col_name [ASC|DESC], ...)]</span><span style="--inversion-type-color:  simple; font-size: 14px; color: rgb(108, 0, 0); font-family: &quot;Courier New&quot;;">//排序</span></font></div></li><li><div><span style="font-size: 14px; --inversion-type-color:  simple; color: rgb(108, 0, 0); font-family: &quot;Courier New&quot;;">INTO</span><span style="font-size: 14px; font-family: &quot;Courier New&quot;;"> num_buckets BUCKETS]</span><span style="font-size: 14px; --inversion-type-color:  simple; color: rgb(108, 0, 0); font-family: &quot;Courier New&quot;;">//分桶数量</span></div></li><li><div><font style="font-size: 14px;"><span style="--inversion-type-color:  simple; font-size: 14px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;;">[ROW FORMAT row_format]</span><span style="--inversion-type-color:  simple; font-size: 14px; color: rgb(108, 0, 0); font-family: &quot;Courier New&quot;;">//表中数据每行的格式，定义数据字段的分隔符，集合元素的分隔符 </span><span style="--inversion-type-color:  simple; font-size: 14px;"><span style="font-size: 14px; --inversion-type-color:  simple; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;;">—</span></span><span style="--inversion-type-color:  simple; font-size: 14px; color: rgb(108, 0, 0); font-family: &quot;Courier New&quot;;"> </span></font><span style="font-size: 14px; --inversion-type-color:  simple; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;;">row format delimited fields terminated by '\t’ </span><span style="--inversion-type-color:  simple; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;;">collection items terminated by ‘,</span><span style="--inversion-type-color:  simple; caret-color: rgb(0, 253, 255); color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;;">’;</span><font style="font-size: 14px;"><span style="--inversion-type-color:  simple; font-size: 14px;"><span style="font-size: 14px; --inversion-type-color: simple; color: rgb(0, 253, 255); font-family: &quot;Courier New&quot;;">（row format delimited fields terminated by '\t’）</span><span style="font-size: 14px; --inversion-type-color:  simple;"><span style="font-size: 14px; --inversion-type-color:  simple; color: rgb(108, 0, 0); font-family: &quot;Courier New&quot;;">//字段分隔符</span></span><span style="font-size: 14px; --inversion-type-color: simple; color: rgb(0, 253, 255); font-family: &quot;Courier New&quot;;">（</span></span></font><span style="--inversion-type-color: simple; color: rgb(0, 253, 255); font-family: &quot;Courier New&quot;;">row format delimited collection items terminated by ',</span><span style="caret-color: rgb(0, 253, 255); --inversion-type-color: simple; color: rgb(0, 253, 255); font-family: &quot;Courier New&quot;;">’</span><span style="--inversion-type-color: simple; color: rgb(0, 253, 255); font-family: &quot;Courier New&quot;;">）</span><span style="--inversion-type-color:  simple; color: rgb(108, 0, 0); font-family: &quot;Courier New&quot;;">//元素分隔符</span></div></li><li><div><span style="font-size: 14px; font-family: &quot;Courier New&quot;;">[</span><span style="font-size: 14px; --inversion-type-color:  simple; color: rgb(108, 0, 0); font-family: &quot;Courier New&quot;;">STORED AS</span><span style="font-size: 14px; font-family: &quot;Courier New&quot;;"> file_format]</span><span style="--inversion-type-color:  simple; font-size: 14px; color: rgb(108, 0, 0); font-family: &quot;Courier New&quot;;">//表中数据存储格式。 </span></div></li><li><div><span style="font-size: 14px; font-family: &quot;Courier New&quot;;">[LOCATION hdfs_path]</span><span style="--inversion-type-color:  simple; font-size: 14px; color: rgb(108, 0, 0); font-family: &quot;Courier New&quot;;">//表在hdfs的位置</span></div></li><ol><li><div><span style="font-size: 14px; color: rgb(255, 0, 0); font-family: &quot;Courier New&quot;;">EXTERNAL：（区别是：在删除时，内部表会删除元数据和表位置；而外部表只会删除元数据）</span></div></li><ol><li><div><span style="--inversion-type-color:  simple; font-size: 14px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;;">不带时 — 创建的表是MANAGED_TABLE(管理表，内务表)</span></div></li><li><div><span style="background-color: rgb(204, 204, 204); --inversion-type-background-color:  simple;"><span style="background-color: rgb(204, 204, 204); --inversion-type-background-color:  simple; --inversion-type-color:  simple;"><span style="background-color: rgb(204, 204, 204); --inversion-type-background-color:  simple; --inversion-type-color:  simple; font-size: 14px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;;">带时 — 创建的表是EXTERNAL_TABLE(外部表)</span></span></span></div></li></ol><li><div><span style="--inversion-type-color:  simple; font-size: 14px; color: rgb(108, 0, 0); font-family: &quot;Courier New&quot;;">PARTITIONED BY:（将表中的数据，分散到表目录下的多个子目录（分区目录）中）当设定的时候，此表会变成一个分区表。分区的母的是为了把数据分散到多个子目录，加快效率。(在分区别插入数据的时候，需要指定分区目录,如果 没有则需要创建分区)</span></div></li><ol><li><div><font style="font-size: 14px;"><span style="--inversion-type-color:  simple; font-size: 14px;">Partitioned by(分区字段 字段类型,</span><span style="--inversion-type-color:  simple; font-size: 14px;">分区字段 字段类型</span><span style="--inversion-type-color:  simple; font-size: 14px;">)</span></font></div></li><li><div>动态分区：<span style="--inversion-type-color:  simple; color: rgb(108, 0, 0);">（必须要在动态分区非严格模式执行，只能insert导入数据</span><span style="--inversion-type-color: simple; color: rgb(0, 253, 255);">set hive.exec.dynamic.partition.mode=nostrict</span></div></li><ol><li><div><span style="caret-color: rgb(0, 253, 255);"><span style="--inversion-type-color:  simple; color: rgb(0, 0, 0);">Insert into table 表名 partition(分区字段名) select * from 导入数据表名  </span></span><span style="--inversion-type-color:  simple; color: rgb(108, 0, 0);">（会根据导入数据表最后一列进行分区） </span></div></li></ol></ol><li><div><font style="font-size: 14px;"><span style="--inversion-type-color:  simple; font-size: 14px; color: rgb(108, 0, 0); font-family: &quot;Courier New&quot;;">CLUSTERED BY：（向分桶表导入数据时，需要打开开关，强制分桶：</span><span style="--inversion-type-color: simple; font-size: 14px; color: rgb(0, 253, 255); font-family: &quot;Courier New&quot;;">set hive.enforce.bucketing=true</span><span style="--inversion-type-color:  simple; font-size: 14px; color: rgb(108, 0, 0); font-family: &quot;Courier New&quot;;">，强制排序：</span><span style="--inversion-type-color: simple; font-size: 14px; color: rgb(0, 253, 255); font-family: &quot;Courier New&quot;;">set hive.enforce.sorting=true</span><span style="--inversion-type-color:  simple; font-size: 14px; color: rgb(108, 0, 0); font-family: &quot;Courier New&quot;;">）</span></font></div></li><ol><li><div><font face="Courier New" style="font-size: 14px; --inversion-type-color:  simple;"><span style="caret-color: rgb(255, 255, 255); font-size: 14px; --inversion-type-color:  simple; font-family: &quot;Courier New&quot;; color: rgb(0, 0, 0);">Clustered by (列名)</span></font></div></li></ol><li><div><font style="font-size: 14px;"><span style="caret-color: rgb(255, 255, 255); font-size: 14px; --inversion-type-color:  simple; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;;"> </span><span style="font-size: 14px; --inversion-type-color:  simple; color: rgb(108, 0, 0); font-family: &quot;Courier New&quot;;">SORTED BY：（默认为正序）</span></font></div></li><ol><li><div><font style="font-size: 14px; --inversion-type-color:  simple;"><span style="caret-color: rgb(255, 255, 255); font-size: 14px; --inversion-type-color:  simple; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;;">Sorted by (列名（asc/desc）) </span></font></div></li></ol><li><div><font face="Courier New" style="font-size: 14px;"><span style="caret-color: rgb(255, 255, 255);"><span style="font-size: 14px; --inversion-type-color:  simple; font-family: &quot;Courier New&quot;; color: rgb(0, 0, 0);">Into 分桶数量 buckets </span><span style="font-size: 14px; --inversion-type-color:  simple; font-family: &quot;Courier New&quot;; color: rgb(108, 0, 0);">(代表需要几个结果文件)</span></span></font></div></li><li><div><span style="font-size: 14px; font-family: &quot;Courier New&quot;;">STORED AS：<span style="font-size: 14px; --inversion-type-color:  simple; font-family: &quot;Courier New&quot;; color: rgb(108, 0, 0);">（</span></span><span style="--inversion-type-color:  simple; font-size: 14px; color: rgb(108, 0, 0); font-family: &quot;Courier New&quot;;">默认为TEXTFILE文本文件，可以设置为textfile,SqunceFile,Paquret,ORC等</span><span style="font-size: 14px;"><span style="font-size: 14px; --inversion-type-color:  simple; color: rgb(108, 0, 0); font-family: &quot;Courier New&quot;;">）</span><span style="font-size: 14px; --inversion-type-color: simple; color: rgb(0, 253, 255); font-family: &quot;Courier New&quot;;">一般推荐使用orc + snappy内部压缩，parquet+lzo内部压缩</span></span></div></li><ol><li><div><span style="--inversion-type-color:  simple; font-size: 14px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;;">压缩比：orc&gt;paquret&gt;textfile。查询速度上无明显差距</span></div></li><li><div><span style="--inversion-type-color:  simple; font-size: 14px;"><span style="font-size: 14px; --inversion-type-color: simple; color: rgb(0, 253, 255); font-family: &quot;Courier New&quot;;">stored as orc tblproperties(属性=属性值)</span></span></div></li><li><div><span style="--inversion-type-color:  simple; font-size: 14px;"><span style="font-size: 14px; --inversion-type-color:  simple; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;;">只有textfile可以用load导入数据，其他格式都要用insert导入</span></span></div></li><li><div><span style="caret-color: rgb(255, 255, 255); --inversion-type-color:  simple; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;;">拥有的属性：</span></div></li><ol><li><div><a href="http://orc.compress/" style="--inversion-type-color:  simple; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;;">orc.compress</a><span style="--inversion-type-color:  simple; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;;"> </span><span style="caret-color: rgb(255, 255, 255); --inversion-type-color:  simple; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;;">—</span><span style="--inversion-type-color:  simple; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;;"> 设置内部压缩，默认是z</span><span style="caret-color: rgb(255, 255, 255);"><span style="--inversion-type-color:  simple; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;;">lib（snappy只支持none</span><span style="--inversion-type-color:  simple; color: rgb(108, 0, 0); font-family: &quot;Courier New&quot;;">(不用压缩)</span><span style="--inversion-type-color:  simple; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;;">,zlib,snappy）</span></span></div></li><li><div><a href="http://orc.compress.size/" style="--inversion-type-color:  simple; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;;">orc.compress.size</a><span style="--inversion-type-color:  simple; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;;"> </span><span style="caret-color: rgb(255, 255, 255); --inversion-type-color:  simple; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;;">—</span><span style="--inversion-type-color:  simple; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;;"> 每多少数据压缩一次</span></div></li><li><div><span style="--inversion-type-color:  simple; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;;">orc.stripe.size </span><span style="caret-color: rgb(255, 255, 255); --inversion-type-color:  simple; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;;">—</span><span style="--inversion-type-color:  simple; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;;"> 设置行的大小</span></div></li><li><div><span style="--inversion-type-color:  simple; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;;">orc.row.index.stride</span></div></li><li><div><span style="--inversion-type-color:  simple; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;;">orc.create.index=true </span><span style="caret-color: rgb(255, 255, 255); --inversion-type-color:  simple; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;;">—</span><span style="--inversion-type-color:  simple; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;;"> 是否使用索引</span></div></li><li><div><span style="--inversion-type-color:  simple; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;;">orc.bloom.filter.columns </span><span style="caret-color: rgb(255, 255, 255); --inversion-type-color:  simple; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;;">— 过滤器</span></div></li><li><div><span style="--inversion-type-color:  simple; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;;">orc.bloom.filter.fpp</span></div></li></ol></ol></ol></ol><li><div><span style="caret-color: rgb(255, 147, 147); --inversion-type-color:  simple; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;;">Create table 源表名 like 新表名; </span></div></li><li><div><span style="caret-color: rgb(255, 255, 255); --inversion-type-color:  simple; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;;">Create</span><span style="--inversion-type-color:  simple; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;;"> table 源表名 as select 语句;</span></div></li><li><div><span style="caret-color: rgb(255, 147, 147); --inversion-type-color:  simple;"><span style="--inversion-type-color:  simple; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;;">Select * from 表名 </span></span><span style="caret-color: rgb(255, 147, 147); --inversion-type-color:  simple; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;;">tablesample(bucket X out of y on 分桶列名)</span></div></li><ol><li><div><span style="caret-color: rgb(255, 255, 255); --inversion-type-color:  simple; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;;">Z:总桶数为z</span></div></li><li><div><span style="--inversion-type-color:  simple; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;;">x:抽样当前表的第几个桶</span><span style="--inversion-type-color:  simple; color: rgb(108, 0, 0); font-family: &quot;Courier New&quot;;">（必须大于0 且 小于等于y）</span></div></li><li><div><span style="caret-color: rgb(255, 255, 255);"><span style="--inversion-type-color:  simple; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;;">Y:每间隔y-1桶抽一个，一共抽z/y桶</span><span style="--inversion-type-color:  simple; color: rgb(108, 0, 0); font-family: &quot;Courier New&quot;;">（y必须是z因子或倍数）</span></span></div></li></ol><li><div><span style="caret-color: rgb(255, 147, 147); --inversion-type-color:  simple; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;;">Alter table 表名 set tblproperties(属性名=属性值) </span></div></li><li><div><span style="--inversion-type-color:  simple; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;;">操作表列：</span></div></li><ol><li><div><span style="caret-color: rgb(255, 255, 255); --inversion-type-color:  simple; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;;">修改列：Alter</span><span style="--inversion-type-color:  simple; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;;"> table 表名 change </span><span style="caret-color: rgb(255, 255, 255);"><span style="--inversion-type-color:  simple; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;;">columns 旧列名 新列名 新列类型 comment 新列注释 (first/after) 列名</span><span style="--inversion-type-color:  simple; color: rgb(108, 0, 0); font-family: &quot;Courier New&quot;;">（排在哪个列名前后，不写则是最前或最后）</span></span></div></li><li><div><span style="caret-color: rgb(255, 147, 147); --inversion-type-color:  simple; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;;">添加列：alter table 表名 add columns（新列名 新类型） </span></div></li><li><div><span style="caret-color: rgb(255, 255, 255);"><span style="--inversion-type-color:  simple; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;;">替换列：alter table 表名 replace columns (新列名，新类型)</span><span style="--inversion-type-color:  simple; color: rgb(108, 0, 0); font-family: &quot;Courier New&quot;;">（注意这里替换列，是把所有列替换成新的）</span></span></div></li></ol><li><div><span style="caret-color: rgb(255, 147, 147); --inversion-type-color:  simple; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;;">导入数据：</span></div></li><ol><li><div><span style="--inversion-type-color:  simple; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;;">将本地数据加载到表目录中：load data local </span><span style="--inversion-type-color:  simple; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;;">inpath ‘数据地址’ into table 表名 </span><span style="--inversion-type-color:  simple; color: rgb(108, 0, 0); font-family: &quot;Courier New&quot;;">（不加local默认导入的是hdfs地址，导入如果是hdfs上的，会执行mv）</span></div></li><li><div><span style="caret-color: rgb(255, 147, 147); --inversion-type-color:  simple; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;;">必须要要用insert导入数据：</span></div></li><ol><li><div><span style="--inversion-type-color:  simple; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;;">向分桶表中插入数据</span></div></li><li><div><span style="caret-color: rgb(255, 147, 147); --inversion-type-color:  simple; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;;">表中的数据，不是以文本的形式存储</span></div></li><li><div><span style="--inversion-type-color:  simple; caret-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;;">Insert into/overwrite</span><span style="caret-color: rgb(255, 255, 255);"><span style="--inversion-type-color:  simple; color: rgb(108, 0, 0); font-family: &quot;Courier New&quot;;">（into是追加，overwrite是覆盖）</span><span style="--inversion-type-color:  simple; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;;">table 表名 （select 语句 / values(),()…）</span></span></div></li><li><div><span style="--inversion-type-color:  simple; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;;">多插入模式：</span><span style="--inversion-type-color:  simple; color: rgb(108, 0, 0); font-family: &quot;Courier New&quot;;">（从一张源表查询，向多个目标表插入）</span></div></li><ol><li><div><span style="caret-color: rgb(255, 255, 255); --inversion-type-color:  simple; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;;">From</span><span style="--inversion-type-color:  simple; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;;"> 源表</span></div></li><li><div><span style="caret-color: rgb(255, 255, 255); --inversion-type-color:  simple; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;;">Insert </span><span style="caret-color: rgb(255, 255, 255); --inversion-type-color:  simple; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;;">into/overwrite</span><span style="caret-color: rgb(255, 255, 255); --inversion-type-color:  simple; color: rgb(108, 0, 0); font-family: &quot;Courier New&quot;;">（into是追加，overwrite是覆盖） </span><span style="caret-color: rgb(255, 255, 255); --inversion-type-color:  simple; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;;">（select 语句 / values(),()…） — </span><span style="caret-color: rgb(255, 255, 255); --inversion-type-color:  simple;"><span style="--inversion-type-color:  simple; color: rgb(108, 0, 0); font-family: &quot;Courier New&quot;;">可以以写多行</span></span></div></li></ol><li><div><span style="--inversion-type-color:  simple; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;;">Import </span><span style="--inversion-type-color:  simple; color: rgb(108, 0, 0); font-family: &quot;Courier New&quot;;">(可以导入数据+元数据+表结构，但是导入的是export输出内容)</span></div></li><ol><li><div><span style="--inversion-type-color:  simple; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;;">import [external] table 表名</span><span style="--inversion-type-color:  simple; color: rgb(108, 0, 0); font-family: &quot;Courier New&quot;;">(可以是新表，或旧表) </span><span style="--inversion-type-color:  simple; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;;">[partition (分区字段=分区值)] from ‘export导出的地址’ [location ‘表在hdfs的位置’]</span><span style="--inversion-type-color:  simple; color: rgb(108, 0, 0); font-family: &quot;Courier New&quot;;">（如果是旧表，会检查表机构属性是否一致，一致才会导入数据，如果有分区表，不管表是否为空，要导入的分区必须是不存在的） </span></div></li></ol></ol></ol><li><div><span style="caret-color: rgb(255, 147, 147); --inversion-type-color:  simple;"><span style="--inversion-type-color:  simple; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;;">导出数据：</span></span></div></li><ol><li><div><span style="caret-color: rgb(255, 255, 255);"><span style="--inversion-type-color:  simple; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;;">Insert:</span><span style="--inversion-type-color:  simple; color: rgb(108, 0, 0); font-family: &quot;Courier New&quot;;">（将一条sql运算的结果，插入到指定的路径）</span></span></div></li><ol><li><div><span style="--inversion-type-color:  simple; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;;">将查询结果导出到本地：insert overwrite local directory '本地地址’ select * from 表名;</span></div></li><li><div><span style="--inversion-type-color:  simple; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;;">将查询结果格式化导出到本地：insert overwrite local directory ‘本地地址’ row format delimited fields terminated by </span><span style="caret-color: rgb(255, 255, 255); --inversion-type-color:  simple; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;;">‘</span><span style="--inversion-type-color:  simple; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;;">\t’ select * from 表名;</span></div></li><li><div><span style="--inversion-type-color:  simple; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;;">将查询的结果导出到hdfs上</span><span style="--inversion-type-color:  simple; color: rgb(108, 0, 0); font-family: &quot;Courier New&quot;;">（没有local）</span><span style="--inversion-type-color:  simple; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;;">：</span><span style="--inversion-type-color:  simple; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;;">insert overwrite directory ‘本地地址’ row format delimited fields terminated by </span><span style="--inversion-type-color:  simple; caret-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;;">‘</span><span style="--inversion-type-color:  simple; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;;">\t’ </span><span style="--inversion-type-color:  simple; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;;">select * from 表名</span><span style="--inversion-type-color:  simple; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;;">; </span></div></li></ol><li><div><span style="caret-color: rgb(255, 255, 255);"><span style="--inversion-type-color:  simple; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;;">Export:</span><span style="--inversion-type-color:  simple; color: rgb(108, 0, 0); font-family: &quot;Courier New&quot;;">（</span></span><span style="--inversion-type-color:  simple; color: rgb(108, 0, 0);">可以导入数据+元数据+表结构，会在hdfs的导出目录中，生成数据和元数据，且导出的元数据与数据库无关</span><span style="caret-color: rgb(255, 255, 255); --inversion-type-color:  simple; color: rgb(108, 0, 0); font-family: &quot;Courier New&quot;;">）</span></div></li><ol><li><div><span style="--inversion-type-color:  simple; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;;">Export table 表名 to ‘hdfs路径' ;</span></div></li><li><div><span style="--inversion-type-color:  simple; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;;">如果是分区表，可以将部分分区导出：export table table 表名 partition(分区字段=分区值) to ‘hdfs路径’;</span></div></li></ol></ol><li><div><span style="--inversion-type-color:  simple; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;;">A&lt;=&gt;B：</span></div></li><ol><li><div><span style="--inversion-type-color:  simple; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;;">如果A,B都为NULL，返回TRUE；</span></div></li><li><div><span style="--inversion-type-color:  simple; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;;">如果其中一方为NULL，返回NULL；</span></div></li><li><div><span style="caret-color: rgb(255, 255, 255); --inversion-type-color:  simple; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;;">其余情况与 = 一致；</span></div></li></ol><li><div><span style="caret-color: rgb(255, 255, 255); --inversion-type-color:  simple; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;;">排序</span></div></li><ol><li><div><span style="--inversion-type-color:  simple; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;;">全排序：Select * from 表名 Order by 列名</span><span style="font-size: 14px; --inversion-type-color:  simple; caret-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;;">（asc/desc）,列名 </span><span style="font-size: 14px; --inversion-type-color:  simple; caret-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;;">（asc/desc）,...</span></div></li><li><div><span style="caret-color: rgb(255, 255, 255); --inversion-type-color:  simple; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;;">部分排序：</span><span style="font-size: 14px; --inversion-type-color:  simple; caret-color: rgb(255, 255, 255); color: rgb(108, 0, 0); font-family: &quot;Courier New&quot;;">（使用前，需要设置reduceTaskNum,且必须大于1）</span><span style="font-size: 14px; --inversion-type-color: simple; caret-color: rgb(255, 255, 255); color: rgb(0, 253, 255); font-family: &quot;Courier New&quot;;">（set mapreduce.job.reduces=x）</span><span style="caret-color: rgb(255, 255, 255); --inversion-type-color:  simple; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;;">select * from 表名 sort by 列名   (</span><span style="font-size: 14px; --inversion-type-color:  simple; caret-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;;">asc/desc）,列名 </span><span style="font-size: 14px; --inversion-type-color:  simple; caret-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;;">（asc/desc）,…</span><span style="font-size: 14px; --inversion-type-color:  simple; caret-color: rgb(255, 255, 255);"><span style="font-size: 14px; --inversion-type-color:  simple; color: rgb(108, 0, 0); font-family: &quot;Courier New&quot;;">（随机分区）</span></span></div></li><li><div><span style="caret-color: rgb(255, 147, 147);"><span style="--inversion-type-color:  simple; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;;">指定按照哪个列名作为key，分区：</span><span style="--inversion-type-color:  simple; color: rgb(108, 0, 0); font-family: &quot;Courier New&quot;;">（只在部分排序，sort by 有意义，需要根据实际数值情况设置</span></span><span style="font-size: 14px; --inversion-type-color:  simple; caret-color: rgb(255, 255, 255); color: rgb(108, 0, 0); font-family: &quot;Courier New&quot;;">reduceTaskNum</span><span style="caret-color: rgb(255, 147, 147);"><span style="--inversion-type-color:  simple; color: rgb(108, 0, 0); font-family: &quot;Courier New&quot;;">）</span><span style="--inversion-type-color:  simple; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;;">select * from 表名 distribute by 列名 sort by 列名 </span></span><span style="--inversion-type-color:  simple; caret-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;;">(</span><span style="font-size: 14px; --inversion-type-color:  simple; caret-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;;">asc/desc）,列名 </span><span style="font-size: 14px; --inversion-type-color:  simple; caret-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;;">（asc/desc）,…</span><span style="font-size: 14px; --inversion-type-color:  simple; caret-color: rgb(255, 255, 255);"><span style="font-size: 14px; --inversion-type-color:  simple; color: rgb(108, 0, 0); font-family: &quot;Courier New&quot;;">（</span></span><span style="font-size: 14px; --inversion-type-color:  simple; caret-color: rgb(255, 255, 255);"><span style="font-size: 14px; --inversion-type-color:  simple; color: rgb(108, 0, 0); font-family: &quot;Courier New&quot;;">指定分区）</span></span></div></li><li><div><span style="caret-color: rgb(255, 147, 147);"><span style="--inversion-type-color:  simple; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;;">分区和排序列名一致：</span><span style="--inversion-type-color:  simple; color: rgb(108, 0, 0); font-family: &quot;Courier New&quot;;">（</span></span><span style="caret-color: rgb(255, 147, 147); --inversion-type-color:  simple; color: rgb(108, 0, 0); font-family: &quot;Courier New&quot;;">需要根据实际数值情况设置</span><span style="font-size: 14px; --inversion-type-color:  simple; caret-color: rgb(255, 255, 255); color: rgb(108, 0, 0); font-family: &quot;Courier New&quot;;">reduceTaskNum</span><span style="caret-color: rgb(255, 147, 147);"><span style="--inversion-type-color:  simple; color: rgb(108, 0, 0); font-family: &quot;Courier New&quot;;">）</span><span style="--inversion-type-color:  simple; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;;">select * from 表名 cluster by 列名; </span><span style="--inversion-type-color:  simple; color: rgb(108, 0, 0); font-family: &quot;Courier New&quot;;">（只能是asc排序）</span></span></div></li></ol><li><div><span style="caret-color: rgb(255, 147, 147); --inversion-type-color:  simple; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;;">Show functions; </span></div></li><li><div><span style="caret-color: rgb(255, 255, 255); --inversion-type-color:  simple; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;;">Desc function 函数名;</span></div></li><ol><li><div><span style="--inversion-type-color:  simple; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;;">Desc function extended 函数名；</span><span style="--inversion-type-color:  simple; color: rgb(108, 0, 0); font-family: &quot;Courier New&quot;;">(查看详细解释) </span></div></li></ol><li><div><span style="caret-color: rgb(255, 147, 147); --inversion-type-color:  simple; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;;">explain [xxx] 查询语句</span></div></li><ol><li><div><span style="caret-color: rgb(255, 255, 255); --inversion-type-color:  simple; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;;">Extended :查看详细查询信息</span></div></li><li><div><span style="--inversion-type-color:  simple; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;;">Dependency: 查看依赖关系</span></div></li><li><div><span style="--inversion-type-color:  simple; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;;">Authorization: 查看授权信息 </span></div></li></ol><li><div><span style="caret-color: rgb(255, 255, 255); --inversion-type-color:  simple; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;;">表优化：</span></div></li><ol><li><div><span style="--inversion-type-color:  simple; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;;">join优化：</span></div></li><ol><li><div><span style="--inversion-type-color:  simple; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;;">set hive.auto.convert.join = true -- 开启MapJoin，默认为true</span></div></li><li><div><span style="--inversion-type-color:  simple; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;;">set hive.mapjoin.smalltable.filesize=25000000 -- 大表小表的阈值设置，默认25M一下认为是小表</span></div></li></ol><li><div><span style="caret-color: rgb(255, 255, 255); --inversion-type-color:  simple; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;;">Group by 优化：</span></div></li><ol><li><div><span style="--inversion-type-color:  simple; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;;">hive.map.aggr = true -- 是否在Map端进行聚合，默认为True</span></div></li><li><div><span style="--inversion-type-color:  simple; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;;">hive.groupby.mapaggr.checkinterval = 100000 -- 在Map端进行聚合操作的条目数目</span></div></li><li><div><span style="--inversion-type-color:  simple; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;;">hive.groupby.skewindata = true -- 有数据倾斜的时候进行负载均衡（默认是false）</span></div></li></ol></ol></ol></td></tr><tr><td colspan="2" style="background-color: rgb(234, 234, 234); border: 1px solid rgb(187, 187, 187); width: 880px; padding: 8px;"><div>报错解决：</div></td></tr><tr><td colspan="2" style="border: 1px solid rgb(204, 204, 204); width: 880px; padding: 8px;"><div>1.<img src="hive-%E8%A1%A8-%E5%B8%B8%E8%A7%81%E6%93%8D%E4%BD%9C.resources/90E3BBA5-1DCD-4936-B111-DD42E106762C.png" height="118" width="1786"/></div><div>Set yarn.nodemanager.vmem-check-enabled=fase</div><div>Set yarn.nodemanager.vmem-pmem-ratio=4</div></td></tr></tbody></table><div><br/></div></body></html>