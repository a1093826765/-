<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><meta name="exporter-version" content="Evernote Mac 9.4.8 (461813)"/><meta name="keywords" content="linux, shell"/><meta name="altitude" content="10.80171966552734"/><meta name="author" content="November"/><meta name="created" content="2020-07-14 07:52:22 +0000"/><meta name="latitude" content="23.08462524414062"/><meta name="longitude" content="112.5096025524944"/><meta name="source" content="desktop.mac"/><meta name="updated" content="2020-07-15 01:26:29 +0000"/><title>自動部署安裝腳本</title></head><body><div><div><br/></div><table style="border-collapse: collapse; min-width: 100%;"><colgroup><col style="width: 441px;"/><col style="width: 439px;"/></colgroup><tbody><tr><td colspan="2" style="background-color: rgb(0, 168, 45); border: 1px solid rgb(0, 134, 36); width: 880px; padding: 8px;"><div style="text-align: center;"><span style="font-size: 24px; color: rgb(204, 204, 204); --inversion-type-color: simple;"><b>自動部署安裝腳本</b></span></div></td></tr><tr><td style="background-color: rgb(234, 234, 234); border: 1px solid rgb(187, 187, 187); width: 441px; padding: 8px;"><div>线索Cues</div></td><td style="background-color: rgb(234, 234, 234); border: 1px solid rgb(187, 187, 187); width: 439px; padding: 8px;"><div>笔记Notes</div></td></tr><tr><td style="border: 1px solid rgb(204, 204, 204); width: 441px; padding: 8px;"><ol><li><div>需要支持expect命令</div></li><li><div>執行免密登陸之前先生成密鑰</div></li><li><div>免密登陸腳本</div></li><li><div>判斷腳本</div></li><li><div>遍歷服務器</div></li><li><div>傳輸安裝腳本並執行</div></li></ol></td><td style="border: 1px solid rgb(204, 204, 204); width: 439px; padding: 8px;"><ol><li><div>yum install expect</div></li><li><div><span style="color: rgb(0, 0, 0); font-family: verdana, &quot;ms song&quot;, 宋体, Arial, 微软雅黑, Helvetica, sans-serif; font-size: 12px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">ssh-keygen -t rsa</span></div></li><li><div>auto_ssh_copy_id(){</div></li><ol><li><div>pdexpect "ssh-copy-id $1" $2;</div></li><li><div>}</div></li></ol><li><div>pdexpect(){</div></li><ol><li><div> expect -c " set timeout -1; </div></li><li><div>spawn $1;</div></li><li><div>expect {</div></li><li><div>*yes/no* { send -- yes\r;exp_continue }</div></li><li><div>*Y/n* { send -- y\r; exp_continue }</div></li><li><div>*assword* { send -- $2\r; exp_continue }</div></li><li><div>eof { exit 0 }</div></li><li><div>}";</div></li><li><div>}</div></li></ol><li><div>ssh_copy_id_to_all(){</div></li><ol><li><div>for SERVER in $SERVER</div></li><li><div>do</div></li><li><div>auto_ssh_copy_id $SERVER $PASSWORD</div></li><li><div>done</div></li><li><div>}</div></li></ol><li><div>for SERVER in $SERVER</div></li><ol><li><div>do</div></li><li><div> scp /root/shell/install.sh root@$SERVER:/root</div></li><li><div> ssh root@$SERVER chmod -R 777 /root/install.sh</div></li><li><div> ssh root@$SERVER sh /root/install.sh</div></li><li><div>done</div></li></ol></ol></td></tr><tr><td colspan="2" style="background-color: rgb(234, 234, 234); border: 1px solid rgb(187, 187, 187); width: 880px; padding: 8px;"><div>总结Summary</div></td></tr><tr><td colspan="2" style="border: 1px solid rgb(204, 204, 204); width: 880px; padding: 8px;"><ul><li><div>记录最重要几点</div></li><li><div>写成可以快速检索形式</div></li><li><div>课后复习总结</div></li></ul><div><br/></div></td></tr></tbody></table><div><br/></div></div><div><br/></div></body></html>